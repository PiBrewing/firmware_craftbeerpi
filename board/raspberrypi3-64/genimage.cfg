image cbpifw-update.bin {
  rauc {
    cert = "cbpifw.cert.pem"
    key = "cbpifw.key.pem"
    manifest = "${RAUC_MANIFEST}"
    files = {
        "bcm2710-rpi-3-b.dtb",
        "bcm2710-rpi-3-b-plus.dtb",
        "bcm2837-rpi-3-b.dtb",
        "cmdline.txt",
        "overlays.tar"
    }
    file kernel7l.img {
      image = "zImage"
    }
    file rootfs.img {
      image = "rootfs.squashfs"
    }
    file hook {
      image = "rauc-hooks.sh"
    }
  }
}

image boot.vfat {
    vfat {
        label = "boot"
        files = {
            "bcm2710-rpi-3-b.dtb",
            "bcm2710-rpi-3-b-plus.dtb",
            "bcm2837-rpi-3-b.dtb",
            "rpi-firmware/bootcode.bin",
            "rpi-firmware/cmdline.txt",
            "config.txt",
            "rpi-firmware/fixup.dat",
            "rpi-firmware/start.elf",
            "rpi-firmware/overlays",
            "image0"
        }

        file image0/kernel7l.img {
            image = "zImage"
        }
        file image0/bcm2711-rpi-4-b.dtb {
            image = "bcm2711-rpi-4-b.dtb"
        }
    }

    size = 32M
}

image srv.img {
  ext4 {
    label = "srv"
  }
  size = 4M
}

image sdcard.img {
    hdimage {
        align = 4M
        partition-table-type = hybrid
    }

    partition boot {
        offset = 4M
        partition-type = 0xC
        partition-type-uuid = "c12a7328-f81f-11d2-ba4b-00a0c93ec93b"
        bootable = "true"
        image = "boot.vfat"
    }

    partition root-a {
        partition-type = 0x83
        partition-type-uuid = "b921b045-1df0-41c3-af44-4c6f280d3fae"
        image = "rootfs.squashfs"
    }

    partition root-b {
        partition-type = 0x83
        partition-type-uuid = "b921b045-1df0-41c3-af44-4c6f280d3fae"
        image = "rootfs.squashfs"
    }

    partition srv {
      partition-type = 0x83
      size = 4M
      partition-type-uuid = "3B8F8425-20E0-4F3B-907F-1A25A76F98E8"
      image = "srv.img"
    }
}